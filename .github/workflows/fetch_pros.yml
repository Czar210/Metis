name: "Metis - Ingestão de Pro Players"

on:
  schedule:
    # Roda toda segunda-feira às 03:00 UTC
    - cron: '0 3 * * 1'
  workflow_dispatch: # Permite que você rode manualmente pelo site do GitHub

jobs:
  ingest-pros:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout do código
        uses: actions/checkout@v4

      - name: Configurar Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: Instalar dependências
        run: |
          pip install requests boto3 python-dotenv

      - name: Rodar Script de Pro Players
        env:
          CLOUDFLARE_R2_ACCOUNT_ID: ${{ secrets.R2_ACCOUNT_ID }}
          CLOUDFLARE_R2_ACCESS_KEY_ID: ${{ secrets.R2_ACCESS_KEY_ID }}
          CLOUDFLARE_R2_SECRET_ACCESS_KEY: ${{ secrets.R2_SECRET_ACCESS_KEY }}
          CLOUDFLARE_R2_BUCKET_NAME: "metis"
        run: python scripts/ingestion/fetch_pro_players.py
